#!/usr/bin/Rscript

# library
library("SticsOnR")
library("SticsRFiles")
library("CroptimizR")
library("CroPlotR")

# paths
pwd <- Sys.getenv("PWD")
javastics_path <- paste(pwd, '/../simulate', sep="")
workspace_path <- "merlot"

# usms
usms <- c("Agrolaguna_1971_2000_CLMcom_CNRM_Historijski",
          "Agrolaguna_2041_2070_CLMcom_CNRM_Projekcije_rcp45",
          "Agrolaguna_2071_2100_CLMcom_CNRM_Projekcije_rcp45",
          "Agrolaguna_2041_2070_rcp85_CLMcom_CNRM_Projekcije_rcp85",
          "Agrolaguna_2071_2100_rcp85_CLMcom_CNRM_Projekcije_rcp85",
          "Agrolaguna_1971_2000_CLMcom_ICHEC_Historijski",
          "Agrolaguna_2041_2070_CLMcom_ICHEC_Projekcije_rcp45",
          "Agrolaguna_2071_2100_CLMcom_ICHEC_Projekcije_rcp45",
          "Agrolaguna_2041_2070_rcp85_CLMcom_ICHEC_Projekcije_rcp85",
          "Agrolaguna_2071_2100_rcp85_CLMcom_ICHEC_Projekcije_rcp85",
          "Agrolaguna_1971_2000_CLMcom_MOHC_Historijski",
          "Agrolaguna_2041_2070_CLMcom_MOHC_Projekcije_rcp45",
          "Agrolaguna_2071_2100_CLMcom_MOHC_Projekcije_rcp45",
          "Agrolaguna_2041_2070_rcp85_CLMcom_MOHC_Projekcije_rcp85",
          "Agrolaguna_2071_2100_rcp85_CLMcom_MOHC_Projekcije_rcp85",
          "Agrolaguna_1971_2000_CLMcom_MPI_Historijski",
          "Agrolaguna_2041_2070_CLMcom_MPI_Projekcije_rcp45",
          "Agrolaguna_2071_2100_CLMcom_MPI_Projekcije_rcp45",
          "Agrolaguna_2041_2070_rcp85_CLMcom_MPI_Projekcije_rcp85",
          "Agrolaguna_2071_2100_rcp85_CLMcom_MPI_Projekcije_rcp85",
          "Agrolaguna_1971_2000_CNRM_Historijski",
          "Agrolaguna_2041_2070_CNRM_Projekcije_rcp45",
          "Agrolaguna_2071_2100_CNRM_Projekcije_rcp45",
          "Agrolaguna_2041_2070_rcp85_CNRM_Projekcije_rcp85",
          "Belje_1971_2000_CLMcom_CNRM_Historijski",
          "Belje_2041_2070_CLMcom_CNRM_Projekcije_rcp45",
          "Belje_2071_2100_CLMcom_CNRM_Projekcije_rcp45",
          "Belje_2041_2070_rcp85_CLMcom_CNRM_Projekcije_rcp85",
          "Belje_2071_2100_rcp85_CLMcom_CNRM_Projekcije_rcp85",
          "Belje_1971_2000_CLMcom_ICHEC_Historijski",
          "Belje_2041_2070_CLMcom_ICHEC_Projekcije_rcp45",
          "Belje_2071_2100_CLMcom_ICHEC_Projekcije_rcp45",
          "Belje_2041_2070_rcp85_CLMcom_ICHEC_Projekcije_rcp85",
          "Belje_2071_2100_rcp85_CLMcom_ICHEC_Projekcije_rcp85",
          "Belje_1971_2000_CLMcom_MOHC_Historijski",
          "Belje_2041_2070_CLMcom_MOHC_Projekcije_rcp45",
          "Belje_2071_2100_CLMcom_MOHC_Projekcije_rcp45",
          "Belje_2041_2070_rcp85_CLMcom_MOHC_Projekcije_rcp85",
          "Belje_2071_2100_rcp85_CLMcom_MOHC_Projekcije_rcp85",
          "Belje_1971_2000_CLMcom_MPI_Historijski",
          "Belje_2041_2070_CLMcom_MPI_Projekcije_rcp45",
          "Belje_2071_2100_CLMcom_MPI_Projekcije_rcp45",
          "Belje_2041_2070_rcp85_CLMcom_MPI_Projekcije_rcp85",
          "Belje_2071_2100_rcp85_CLMcom_MPI_Projekcije_rcp85",
          "Belje_1971_2000_CNRM_Historijski",
          "Belje_2041_2070_CNRM_Projekcije_rcp45",
          "Belje_2071_2100_CNRM_Projekcije_rcp45",
          "Belje_2041_2070_rcp85_CNRM_Projekcije_rcp85",
          "Belje_2071_2100_CNRM_Projekcije_rcp85",
          "Blato_1971_2000_CLMcom_CNRM_Historijski",
          "Blato_2041_2070_CLMcom_CNRM_Projekcije_rcp45",
          "Blato_2071_2100_CLMcom_CNRM_Projekcije_rcp45",
          "Blato_2041_2070_rcp85_CLMcom_CNRM_Projekcije_rcp85",
          "Blato_2071_2100_rcp85_CLMcom_CNRM_Projekcije_rcp85",
          "Blato_1971_2000_CLMcom_ICHEC_Historijski",
          "Blato_2041_2070_CLMcom_ICHEC_Projekcije_rcp45",
          "Blato_2071_2100_CLMcom_ICHEC_Projekcije_rcp45",
          "Blato_2041_2070_rcp85_CLMcom_ICHEC_Projekcije_rcp85",
          "Blato_2071_2100_rcp85_CLMcom_ICHEC_Projekcije_rcp85",
          "Blato_1971_2000_CLMcom_MOHC_Historijski",
          "Blato_2041_2070_CLMcom_MOHC_Projekcije_rcp45",
          "Blato_2071_2100_CLMcom_MOHC_Projekcije_rcp45",
          "Blato_2041_2070_rcp85_CLMcom_MOHC_Projekcije_rcp85",
          "Blato_2071_2100_rcp85_CLMcom_MOHC_Projekcije_rcp85",
          "Blato_1971_2000_CLMcom_MPI_Historijski",
          "Blato_2041_2070_CLMcom_MPI_Projekcije_rcp45",
          "Blato_2071_2100_CLMcom_MPI_Projekcije_rcp45",
          "Blato_2041_2070_rcp85_CLMcom_MPI_Projekcije_rcp85",
          "Blato_2071_2100_rcp85_CLMcom_MPI_Projekcije_rcp85",
          "Blato_1971_2000_CNRM_Historijski",
          "Blato_2041_2070_CNRM_Projekcije_rcp45",
          "Blato_2071_2100_CNRM_Projekcije_rcp45",
          "Blato_2041_2070_rcp85_CNRM_Projekcije_rcp85",
          "Blato_2071_2100_CNRM_Projekcije_rcp85",
          "Kutjevo_1971_2000_CLMcom_CNRM_Historijski",
          "Kutjevo_2041_2070_CLMcom_CNRM_Projekcije_rcp45",
          "Kutjevo_2071_2100_CLMcom_CNRM_Projekcije_rcp45",
          "Kutjevo_2041_2070_rcp85_CLMcom_CNRM_Projekcije_rcp85",
          "Kutjevo_2071_2100_rcp85_CLMcom_CNRM_Projekcije_rcp85",
          "Kutjevo_1971_2000_CLMcom_ICHEC_Historijski",
          "Kutjevo_2041_2070_CLMcom_ICHEC_Projekcije_rcp45",
          "Kutjevo_2071_2100_CLMcom_ICHEC_Projekcije_rcp45",
          "Kutjevo_2041_2070_rcp85_CLMcom_ICHEC_Projekcije_rcp85",
          "Kutjevo_2071_2100_rcp85_CLMcom_ICHEC_Projekcije_rcp85",
          "Kutjevo_1971_2000_CLMcom_MOHC_Historijski",
          "Kutjevo_2041_2070_CLMcom_MOHC_Projekcije_rcp45",
          "Kutjevo_2071_2100_CLMcom_MOHC_Projekcije_rcp45",
          "Kutjevo_2041_2070_rcp85_CLMcom_MOHC_Projekcije_rcp85",
          "Kutjevo_2071_2100_rcp85_CLMcom_MOHC_Projekcije_rcp85",
          "Kutjevo_1971_2000_CLMcom_MPI_Historijski",
          "Kutjevo_2041_2070_CLMcom_MPI_Projekcije_rcp45",
          "Kutjevo_2071_2100_CLMcom_MPI_Projekcije_rcp45",
          "Kutjevo_2041_2070_rcp85_CLMcom_MPI_Projekcije_rcp85",
          "Kutjevo_2071_2100_rcp85_CLMcom_MPI_Projekcije_rcp85",
          "Kutjevo_1971_2000_CNRM_Historijski",
          "Kutjevo_2041_2070_CNRM_Projekcije_rcp45",
          "Kutjevo_2071_2100_CNRM_Projekcije_rcp45",
          "Kutjevo_2041_2070_rcp85_CNRM_Projekcije_rcp85",
          "Kutjevo_2071_2100_CNRM_Projekcije_rcp85",
          "Porec_1971_2000_CLMcom_CNRM_Historijski",
          "Porec_2041_2070_CLMcom_CNRM_Projekcije_rcp45",
          "Porec_2071_2100_CLMcom_CNRM_Projekcije_rcp45",
          "Porec_2041_2070_rcp85_CLMcom_CNRM_Projekcije_rcp85",
          "Porec_2071_2100_rcp85_CLMcom_CNRM_Projekcije_rcp85",
          "Porec_1971_2000_CLMcom_ICHEC_Historijski",
          "Porec_2041_2070_CLMcom_ICHEC_Projekcije_rcp45",
          "Porec_2071_2100_CLMcom_ICHEC_Projekcije_rcp45",
          "Porec_2041_2070_rcp85_CLMcom_ICHEC_Projekcije_rcp85",
          "Porec_2071_2100_rcp85_CLMcom_ICHEC_Projekcije_rcp85",
          "Porec_1971_2000_CLMcom_MOHC_Historijski",
          "Porec_2041_2070_CLMcom_MOHC_Projekcije_rcp45",
          "Porec_2071_2100_CLMcom_MOHC_Projekcije_rcp45",
          "Porec_2041_2070_rcp85_CLMcom_MOHC_Projekcije_rcp85",
          "Porec_2071_2100_rcp85_CLMcom_MOHC_Projekcije_rcp85",
          "Porec_1971_2000_CLMcom_MPI_Historijski",
          "Porec_2041_2070_CLMcom_MPI_Projekcije_rcp45",
          "Porec_2071_2100_CLMcom_MPI_Projekcije_rcp45",
          "Porec_2041_2070_rcp85_CLMcom_MPI_Projekcije_rcp85",
          "Porec_2071_2100_rcp85_CLMcom_MPI_Projekcije_rcp85",
          "Porec_1971_2000_CNRM_Historijski",
          "Porec_2041_2070_CNRM_Projekcije_rcp45",
          "Porec_2071_2100_CNRM_Projekcije_rcp45",
          "Porec_2041_2070_rcp85_CNRM_Projekcije_rcp85",
          "Porec_2071_2100_CNRM_Projekcije_rcp85",
          "Zadar_1971_2000_CLMcom_CNRM_Historijski",
          "Zadar_2041_2070_CLMcom_CNRM_Projekcije_rcp45",
          "Zadar_2071_2100_CLMcom_CNRM_Projekcije_rcp45",
          "Zadar_2041_2070_rcp85_CLMcom_CNRM_Projekcije_rcp85",
          "Zadar_2071_2100_rcp85_CLMcom_CNRM_Projekcije_rcp85",
          "Zadar_1971_2000_CLMcom_ICHEC_Historijski",
          "Zadar_2041_2070_CLMcom_ICHEC_Projekcije_rcp45",
          "Zadar_2071_2100_CLMcom_ICHEC_Projekcije_rcp45",
          "Zadar_2041_2070_rcp85_CLMcom_ICHEC_Projekcije_rcp85",
          "Zadar_2071_2100_rcp85_CLMcom_ICHEC_Projekcije_rcp85",
          "Zadar_1971_2000_CLMcom_MOHC_Historijski",
          "Zadar_2041_2070_CLMcom_MOHC_Projekcije_rcp45",
          "Zadar_2071_2100_CLMcom_MOHC_Projekcije_rcp45",
          "Zadar_2041_2070_rcp85_CLMcom_MOHC_Projekcije_rcp85",
          "Zadar_2071_2100_rcp85_CLMcom_MOHC_Projekcije_rcp85",
          "Zadar_1971_2000_CLMcom_MPI_Historijski",
          "Zadar_2041_2070_CLMcom_MPI_Projekcije_rcp45",
          "Zadar_2071_2100_CLMcom_MPI_Projekcije_rcp45",
          "Zadar_2041_2070_rcp85_CLMcom_MPI_Projekcije_rcp85",
          "Zadar_2071_2100_rcp85_CLMcom_MPI_Projekcije_rcp85",
          "Zadar_1971_2000_CNRM_Historijski",
          "Zadar_2041_2070_CNRM_Projekcije_rcp45",
          "Zadar_2071_2100_CNRM_Projekcije_rcp45",
          "Zadar_2041_2070_rcp85_CNRM_Projekcije_rcp85",
          "Zadar_2071_2100_CNRM_Projekcije_rcp85")

# gen_usms
gen_usms_xml2txt(javastics_path,
                 workspace = workspace_path,
                 usm = usms,
                 out_dir = workspace_path,
                 verbose = TRUE)

# model
model_options <- stics_wrapper_options(
  javastics = javastics_path,
  workspace = file.path(javastics_path, workspace_path),
  cores = as.numeric(Sys.getenv('NSLOTS')),
  parallel = TRUE,
  time_display = TRUE,
)

# load optimized values
load("optimized/merlot/optim_results.Rdata")

# simulate
var_name <- c("ilevs", "iflos", "ilaxs", "irecs", "H2Orec_percent")
stics_wrapper(param_values = res$MAP,
              model_options = model_options,
              situation = usms,
              var = var_name)
